### NOTES
#
# 1. For further documentation on the orchestrator, see
#  the README of this project.
#
# 2. The following `trigger` blocks may need to be modified as:
#  trigger_[PROJECT_NAME]:
#     stage: [THE_STAGE_FOR_THIS_PROJECT]
#     trigger:
#       project: [NAMESPACE_AND_PROJECT_NAME]
#
# 3. Some stages may not exist for a given benchmark or some may be added;
#  these can be removed or added from the `stages:` block. 
# How the stages are named is flexible but has to correspond to the `stage`
#  in the trigger blocks. 
#
# 4. Some blocks are commented out below, but represent a template 
# for what can be added and altered 


# DO NOT MODIFY
variables:
  GIT_STRATEGY: fetch
  GIT_SSL_NO_VERIFY: "true"
  GIT_LFS_SKIP_SMUDGE: 1
  OMNIBENCHMARK_NAME: {{benchmark_name}}
  TRIPLESTORE_URL: https://omnibenchmark.org/{{triplestore_url}}_data
  CI_UPSTREAM_PROJECT: ${CI_PROJECT_PATH}
  OMNI_UPDATE_TOKEN: ${OMNI_UPDATE_TOKEN}
  CI_PUSH_TOKEN: ${CI_PUSH_TOKEN}


# This is an example of step in your benchmarking pipeline. 
# The stages must correspond to the stages in the trigger blocks. 
stages:
  - build
  - data_run
  - process_run
  - parameter_run
  - method_run
  - metric_run
  - summary_run


# DO NOT MODIFY
image_build:
  stage: build
  image: docker:stable
  before_script:
    - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN http://$CI_REGISTRY
  script: |
    CI_COMMIT_SHA_7=$(echo $CI_COMMIT_SHA | cut -c1-7)
    docker build --tag $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA_7 .
    docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA_7


# Below are example trigger blocks. 
# You can rename them and specify your projects namespace.
trigger_dataset1:
  stage: data_run
  only:
    - schedules
  trigger: 
    project: omnibenchmark/omni_project/dataset1
    strategy: depend


#trigger_dataset2:
#  stage: data_run
#  only:
#    - schedules
#  trigger: 
#    project: omnibenchmark/omni_project/dataset2
#    strategy: depend


trigger_data_preprocessing:
  stage: process_run
  only:
    - schedules
  trigger: 
    project: omnibenchmark/omni_project/preprocessing
    strategy: depend


trigger_parameters_module:
  stage: parameter_run
  only:
    - schedules
  trigger: 
    project: omnibenchmark/omni_project/parameters
    strategy: depend
    

trigger_analysis_method1:
  stage: method_run
  only:
    - schedules
  trigger: 
    project: omnibenchmark/omni_project/method1
    strategy: depend

#trigger_analysis_method2:
#  stage: method_run
#  only:
#    - schedules
#  trigger: 
#    project: omnibenchmark/omni_project/method2
#    strategy: depend

trigger_metric1:
  stage: metric_run
  only:
    - schedules
  trigger: 
    project: omnibenchmark/omni_project/metric1
    strategy: depend

#trigger_metric2:
#  stage: metric_run
#  only:
#    - schedules
#  trigger: 
#    project: omnibenchmark/omni_project/metric2
#    strategy: depend

trigger_summary_metric:
  stage: summary_run
  only:
    - schedules
  trigger: 
    project: omnibenchmark/omni_project/summary_project
    strategy: depend
